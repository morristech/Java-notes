## 应用层

### 1.网络应用程序体系结构包括：

1. **客户-服务器体系结构(CS)**：有一个总是打开的主机称为服务器，它服务于来自许多其他客户的主机的请求。
2. **对等体系结构(P2P)**:应用程序在间断连接的主机对之间直接通信。对等方式下，可以把每个相连的主机当成既是主机又是客户，可以互相下载对方的共享文件。

### 2.进程通信

进程之间通信有两种，一种是在**同一端系统**中，它由操作系统来决定。另一种是在**不同端系统**中，通过跨计算机网络交换报文完成。

进程通过**套接字**的软件接口从网络中收发报文。套接字相当于门，发送数据相当于将数据“推出门”。它是同一端系统中**应用层和运输层**之间的接口。对于进行寻址，我们通过为套接字指定**IP地址和端口号**来实现。这就相当于指定了**对方**的门牌号。

当我们将数据”推出门“之后有两种可选的传输方式：**UDP和TCP**(属于运输层的协议)。不过两者都没有实现加密机制，因此就出现了TCP的加强版**SSL(安全套接字)**，它是TCP的加强，不属于第三种运输协议。

### 3.应用层协议

定义了运行在端系统上的应用程序进行如何相互传递报文(就是某种特性类型应用程序的规则)。主要有：

1. Web和流式多媒体：**HTTP协议**；
2. 电子邮件：SMTP；
3. 远程终端访问：Telnet；
4. 文件传输：FTP;
5. 因特网电话：SIP、RTP；

#### HTTP协议

1. 全称**超文本传输协议**。
2. HTTP使用**TCP**作为它的支撑协议，TCP默认使用80端口。
3. 它是**无状态的**，就是说它不会记录你之前是否访问过某个对象，它不保存任何关于客户的信息。
4. 它有两种连接方式，**非持续连接和持续连接**。它们的区别在于，非持续连接发送一个请求获取内容之后，对内容里的链接会再分别发送TCP请求获取；持续连接当获取到内容之后，使用之前的TCP获取相关的内容。后者节省了建立连接的时间，效率更高。

HTTP三点注意事项：

1. **HTTP是无连接**：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
2. **HTTP是媒体独立的**：这意味着，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送。客户端以及服务器指定使用适合的MIME-type内容类型。
3. **HTTP是无状态**：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

##### 1.HTTP请求报文

HTTP请求包含以下三个部分：

1. 请求方法-统一资源标识符(URI)-协议/版本
2. 请求头
3. 实体

如下所示：

    GET /somedir/page.jsp HTTP/1.1
    Accept: text/plain; text/html
    Accept-Language: en-gb
    Connection: keep-Alive
    Host: localhost
    User-Agent: Mozilla/4.0
    Content-Length: 33
    Content-Type: application/x-www-form-urlencoded
    Accept-Encoding: gzip, deflate
    
    lastName=Franks&firstName=Michael

1. 请求方法共有**GET、POST、HEAD、PUT和DELETE**等，其中GET大约占90%。HEAD类似GET，但不返回请求对象。PUT表示上传对象到服务器。DELETE表示删除服务器上的对象。
2. **URI**是相应的**URL**的后缀，通常被解释为相对于服务器根目录的路径；
3. 请求头包含客户端和实体正文的相关信息，各个请求头之间使用**“换行/回车”符(CRLF)**隔开；
4. 请求头和实体之间有一个空行，该空行只有CRLF符，对HTTP格式非常重要。
5. **Host**指明对象主机，它在Web代理高速缓存中有作用；
6. **Connection**可取的值有keep-Alive和close，分别对应持续连接和非持续连接；
7. **User-Agent**指明向服务器发送请求的浏览器。

##### 2.HTTP响应报文

HTTP响应报文包含以下三部分：

1. 协议-状态码-描述
2. 响应头
3. 响应实体段

如下所示：

    HTTP/1.1 200 OK
    Server: Microft-IIS/4.0
    Date: Mon, 5 Jan 2004 12:11：22 GMT
    Content-Type: text/html
    Last-Modified: Mon, 5 Jan 2004 11:11:11 GMT
    Content-Length: 112

    <html>.....</html>

1. 响应头和响应实体之间使用一个CRLF符分隔;
2. Last-Modified缓存服务器中有作用；
3. 状态码的五种可能取值：
	1. 1xx：指示信息--表示请求已接收，继续处理
	2. 2xx：成功--表示请求已被成功接收、理解、接受
	3. 3xx：重定向--要完成请求必须进行更进一步的操作
	4. 4xx：客户端错误--请求有语法错误或请求无法实现
	5. 5xx：服务器端错误--服务器未能实现合法的请求
3. 常见的状态码:
	1. 200 OK：请求成功；
	2. 301 Moved Permanelty: 请求对象被永久转移；
	3. 400 Bad Request: 请求不被服务器理解；
	4. 404 Not Found: 请求的文档不在服务器；
	5. 505 HTTP Version Not Supperted： 服务器不支持的HTTP协议。

##### 3.cookie

因为HTTP是无状态的，为此HTTP使用了cookie将用户与站点关联起来。在初次登录某站点的时候，服务器会在响应报文中加入一个`Set-cookie`首部行用于返回cookie信息，同时服务器本身也保存了一份cookie信息；当获取到请求的时候用户浏览器保存一份cookie数据，下次再次请求的时候会在请求的报文中加入cookie信息。

#### SMTP协议

相关的题目

1. 下列关于SMTP 协议的叙述中，正确的是（仅I、II和IV）

		I．只支持传输7比特ASCII码内容 
		II．支持在邮件服务器之间发送邮件 
		III．支持从用户代理向邮件服务器发送邮件 
		IV．支持从邮件服务器向用户代理发送邮件 

### 4.Web缓存

通过在**代理服务器**中缓存访问过的对象来提升用户访问的响应速率。但原始服务器上面的信息有可能没有及时更新到代理服务器中，所以可以使用**条件GET**来进行访问。通过指定日期让代理服务器执行最新检查，即向原始服务器发送信息检查对象的内容有没有变化。

### 5.域名系统DNS

**DSN**是一个分层的DNS服务器实现的分布式数据库，使得主机能够查询分布式数据库的应用层协议。用户主机通过向网络中发送查询报文来获取一个域名对应的IP地址。报文使用UDP数据报，经**端口53**发送。

DNS服务器大致分成：**根DNS服务器**、**顶级域名DNS服务器**和**权威DNS服务器**三个层次。当需要获取某个域名的ip地址的时候，首先向根DNS服务器发送信息获取指定的顶级域名DNS服务器，然后再向顶级域名DNS服务器发送信息来获取权威DNS服务器，最后向权威DNS服务器发送信息来获取指定域名的ip地址。

从上面的查询过程可以看出，实际在查询一个域名的ip地址的时候，需要经过多次查询。为了提升查询的效率，DNS系统使用了DNS缓存来提升效率。它会存储历史的查询结果，当下次进行同样的查询的时候立刻返回查询结果。




